<!DOCTYPE html>
<html>
<head>
    <title>View Election - BlockVote</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        *{margin:0;padding:0;box-sizing:border-box;font-family:'Cormorant Garamond',serif}
        body{background:#eef2f6;color:#0f172a}

        .navbar{
            height:64px;
            display:flex;
            justify-content:space-between;
            align-items:center;
            padding:0 44px;
            background:#ffffff;
            border-bottom:1px solid #dbe3ed;
        }
        .brand{display:flex;align-items:center;gap:10px;font-size:28px;font-weight:800}
        .brand-mark{
            width:28px;height:28px;border-radius:7px;background:#0b5cad;color:#fff;
            display:flex;align-items:center;justify-content:center;font-size:15px;font-weight:700;
        }
        .brand-text{font-size:29px;line-height:1}

        .nav-links{display:flex;gap:18px;align-items:center}
        .nav-links a{
            text-decoration:none;color:#0f172a;font-size:14px;font-weight:500;padding:6px 10px;border-radius:8px;
        }
        .nav-links a:hover{background:#e2e8f0}

        .page{padding:28px 44px 52px}

        .hero{
            display:flex;justify-content:space-between;align-items:center;gap:16px;
            background:#e1e7ef;border:1px solid #d1dae6;border-radius:12px;padding:22px 22px;
        }
        .profile{display:flex;align-items:center;gap:16px}
        .avatar{
            width:52px;height:52px;border-radius:999px;background:#0b5cad;color:#fff;
            display:flex;align-items:center;justify-content:center;font-weight:700;font-size:20px;
        }
        .profile-name{font-size:34px;font-weight:800;line-height:1.05;margin-bottom:3px}
        .profile-meta{font-size:13px;color:#334155}
        .tag{
            display:inline-block;background:#059669;color:#fff;border-radius:6px;
            padding:2px 8px;font-size:12px;font-weight:700;margin-left:8px;
        }
        .logout-btn{
            text-decoration:none;border:1px solid #c4cfdd;color:#0f172a;background:#f8fafc;
            padding:10px 14px;border-radius:8px;font-size:14px;font-weight:600;
        }

        .grid{
            margin-top:16px;
            display:grid;
            grid-template-columns:2fr 1fr;
            gap:18px;
            align-items:start;
        }
        .card{
            background:#ffffff;border:1px solid #ced8e5;border-radius:12px;
            box-shadow:0 2px 7px rgba(16,24,40,.06);padding:20px;
        }
        .card h3{font-size:28px;font-weight:800;margin-bottom:8px}
        .muted{color:#475569;font-size:14px}
        .subtle{color:#64748b;font-size:13px}

        .section-title{font-size:18px;font-weight:700;margin-bottom:4px}
        .section-sub{font-size:14px;color:#475569;margin-bottom:14px}

        .election-chip{
            display:flex;justify-content:space-between;gap:8px;align-items:center;
            border:1px solid #0b5cad;border-radius:8px;background:#eef4fc;padding:14px 14px;
        }
        .chip-name{font-size:22px;font-weight:700;margin-bottom:4px}
        .chip-meta{font-size:13px;color:#475569}
        .status-badge{
            font-size:12px;font-weight:700;padding:3px 10px;border-radius:7px;color:#fff;background:#059669;
        }
        .status-badge.inactive{background:#ef4444}

        .post-block{margin-top:16px}
        .post-title{font-size:20px;font-weight:700;margin:0 0 10px}
        .candidate{
            border:1px solid #d2dbe8;border-radius:9px;background:#f8fafc;
            padding:14px 14px;margin-bottom:10px;display:flex;justify-content:space-between;gap:12px;align-items:center;
        }
        .candidate.active{border-color:#0b5cad;background:#eef4fc}
        .cand-name{font-size:22px;font-weight:700;margin-bottom:2px}
        .cand-meta{font-size:13px;color:#475569}

        .action a,.action button{
            border:none;border-radius:8px;padding:10px 14px;font-weight:600;font-size:14px;cursor:pointer;
        }
        .vote-btn{background:#0b5cad;color:#fff;text-decoration:none;display:inline-block}
        .disabled{background:#94a3b8;color:#fff}
        .ok{color:#059669;font-weight:700;font-size:13px}
        .note{color:#64748b;font-size:13px}

        .info-list{display:grid;grid-template-columns:1fr auto;gap:12px 10px;font-size:14px}
        .history-item{
            border:1px solid #d2dbe8;border-radius:8px;padding:12px;background:#f8fafc;margin-top:10px;
        }
        .history-title{font-size:15px;font-weight:700}

        @media(max-width: 980px){
            .navbar{padding:0 16px}
            .page{padding:16px}
            .brand{font-size:22px}
            .brand-text{font-size:23px}
            .profile-name{font-size:24px}
            .grid{grid-template-columns:1fr}
            .nav-links{gap:8px;flex-wrap:wrap;justify-content:flex-end}
            .nav-links a{padding:4px 8px;font-size:13px}
        }
    </style>
</head>
<body>

{% if request.session.show_navbar or request.session.wallet %}
<div class="navbar">
    <div class="brand">
        <div class="brand-mark">&#10003;</div>
        <div class="brand-text">BlockVote</div>
    </div>
    <div class="nav-links">
        <a href="/">Home</a>
        <a href="/register/">Voter</a>
        <a href="/results/">Results</a>
    </div>
</div>
{% endif %}

<div class="page">
    <div class="hero">
        <div class="profile">
            <div class="avatar">{{ wallet|default:"NA"|slice:":2"|upper }}</div>
            <div>
                <div class="profile-name">Voter Panel</div>
                <div class="profile-meta">
                    Wallet: {{ wallet|default:"Not logged in"|slice:":10" }}...{% if wallet %} <span class="tag">Verified</span>{% endif %}
                </div>
            </div>
        </div>
        {% if request.session.wallet %}
            <a class="logout-btn" href="{% url 'voter_logout' %}">Logout</a>
        {% endif %}
    </div>

    <div class="grid">
        <div>
            <div class="card">
                <div class="section-title">Active Election</div>
                <div class="section-sub">Select your preferred candidate for each post.</div>

                <div class="election-chip">
                    <div>
                        <div class="chip-name">{{ election.name }}</div>
                        <div class="chip-meta">{{ posts|length }} post{{ posts|length|pluralize }} available</div>
                    </div>
                    {% if election.is_active %}
                        <span class="status-badge">active</span>
                    {% else %}
                        <span class="status-badge inactive">inactive</span>
                    {% endif %}
                </div>
            </div>

            <div class="card" style="margin-top:14px;">
                <div class="section-title">Select Candidate</div>
                <div class="section-sub">Choose your preferred candidate.</div>

                {% for post in posts %}
                    <div class="post-block">
                        <h3 class="post-title">{{ post.name }}</h3>

                        {% for candidate in post.candidate_set.all %}
                            <div class="candidate {% if candidate.id in voted_candidate_ids %}active{% endif %}">
                                <div>
                                    <div class="cand-name">{{ candidate.name }}</div>
                                    <div class="cand-meta">
                                        {{ candidate.department|default:"N/A" }} | Sem {{ candidate.semester|default:"N/A" }}
                                    </div>
                                </div>

                                <div class="action">
                                    {% if not wallet %}
                                        <a class="vote-btn" href="{% url 'voter_login' %}">Login to Vote</a>
                                    {% else %}
                                        {% if not election.is_active %}
                                            <button class="disabled" disabled>Election Inactive</button>
                                        {% elif candidate.id in voted_candidate_ids %}
                                            <div class="ok">You voted</div>
                                        {% elif post.id in voted_post_ids %}
                                            <div class="note">Already voted for this post</div>
                                        {% else %}
                                            <a class="vote-btn" href="{% url 'cast_vote' candidate.id %}">Cast Vote</a>
                                        {% endif %}
                                    {% endif %}
                                </div>
                            </div>
                        {% empty %}
                            <p class="muted">No candidates for this post.</p>
                        {% endfor %}
                    </div>
                {% empty %}
                    <p class="muted">No posts for this election.</p>
                {% endfor %}
            </div>
        </div>

        <div>
            <div class="card">
                <h3 style="font-size:18px;margin-bottom:12px;">Voter Information</h3>
                <div class="info-list">
                    <div class="subtle">election</div>
                    <div>{{ election.name }}</div>
                    <div class="subtle">wallet</div>
                    <div>{{ wallet|default:"N/A"|slice:":12" }}...</div>
                    <div class="subtle">posts</div>
                    <div>{{ posts|length }}</div>
                    <div class="subtle">verified</div>
                    <div>{% if wallet %}true{% else %}false{% endif %}</div>
                </div>
            </div>

            <div class="card" style="margin-top:14px;">
                <h3 style="font-size:18px;margin-bottom:12px;">Your Vote History</h3>
                {% if voted_candidate_ids %}
                    {% for candidate in candidates %}
                        {% if candidate.id in voted_candidate_ids %}
                            <div class="history-item">
                                <div class="history-title">{{ candidate.post.name }}</div>
                                <div class="muted">Voted for: {{ candidate.name }}</div>
                            </div>
                        {% endif %}
                    {% endfor %}
                {% else %}
                    <p class="muted">No votes recorded yet.</p>
                {% endif %}
            </div>
        </div>
    </div>
</div>

</body>
</html>

